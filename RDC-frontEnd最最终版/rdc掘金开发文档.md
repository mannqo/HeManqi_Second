## 1. 功能

### 1、登录

+ 未登录时，显示“请先进行登录”字样，无法使用其他功能
+ 未登录时，点击写文章按钮，会弹出登录框
+ 登录时，会一些简单的提示(填写账号密码，账号或密码错误，账号在别处登陆过了等)。
+ 登录之后，会渲染主页文章(第一页)，页面右侧布局发生改变

### 2、主页（首页）

+ 不管在哪个页面，点击header上的首页都会跳转到首页

+ 渲染主页文章(懒加载功能，当滚动条滑倒底的时候，触发获取第二页主页文章的请求，以此类推)
+ 点赞、点踩的功能【已点赞(绿)或点踩(蓝)】
+ 点击文章标题进入文章详情
  + 点击作者的名称可以进入作者的个人主页
  + 可以通过关注按钮关注用户
  + 评论和回复可以发表`emoji`表情
+ 评论和回复有显示回复的对象
  
+ 当滚动条滑到一定的位置时，右侧的图片及位置会发生改变

### 3、个人主页

+ 点击文章会显示用户写的文章
+ 点击 赞-文章 显示点赞的文章
+ 点击 更多-关注 显示关注用户
  + 点击关注者显示关注用户
  + 点击昵称进入其个人主页，(昵称点击事件失效，编辑资料按钮消失，当再次进入自己的主页时候会再次出现)
  + 右侧均有关注/未关注按钮
+ 点击 自己的昵称 或者 编辑个人资料 都可以进入编辑个人资料的页面

### 4、编辑资料

+ 可以修改头像，用户名和个人介绍，修改后立刻刷新
+ 点击 返回个人主页 会返回个人主页

### 5、写文章

+ 必填文章标题和内容
+ hover到icon上面会立亮
+ 点击 返回主页或首页 均返回主页
+ 点击 头像-个人主页 跳转到个人主页

## 2. 实现方法

1. 主页

   + 监听scroll事件，当到了一定高度时改变布局(absolute -> fixed)
   + 渲染主页的所有文章(`paintArticle`)
     + 递归，当滚动条滑到底部时，加载更多的文章(懒加载)
     + 对于所有文章，这里使用了数组合并`concat` 的方法，将所有获取到的文章都放在一个数组里面，再进行渲染
     + 点击标题变色，并进入文章详情(`articleDetail`)
     + 点击赞(`thumbUpAndDown`)、踩(`dislikeOrNot`)，分别调用相对应的函数
   + 跳转主页：在任意一个页面中，点击顶部首页 或 掘金logo图片 都会跳转到首页
   + 文章详情
   + 点赞、点踩

2. 登录

   + 初始时点击 写文章 或者 登录按钮 都会跳转登录页面
   + 登录时，通过对`input.value`的判断提示相关信息
   + 登录成功，跳转页面。将用户信息存储(`localStorage`)到浏览器中
   + 登录成功，渲染主页文章并改变右侧布局
   + 如果曾经登陆过，一上来就判断用户登录状态
   + 登出成功，跳转页面，退出登录

3. 写文章页面

   + 必填文章标题和文章详情
   + 文章标签只是一个装饰
   + 右上角有一个返回到主页的按钮
   + 鼠标移入图标会改变其背景颜色

4. 文章详情

   + 获取文章详情内容并进行渲染
   + 点击作者的头像，调用(`goToOthers`)跳转到ta的个人主页
   + 当进入的这个作者就是自己，有 编辑资料 的按钮
   + 点击关注按钮，调用 关注/取消关注 的接口并改变关注按钮的样式
   + 侧边点赞点踩功能
   + 评论
     + 递归，每次获取5条评论，当评论数不足以5条时停止获取
     + 获取到评论后，查看这个评论的人是不是自己，如果是的话就显示删除按钮，并给删除按钮添加点击删除的事件
     + 当点击评论后的 回复 框框时，会在这里生成回复框对应的`html`。
     + 不管是评论后还是回复后，都会重新渲染文章详情页面
   + 回复
     + 用一个数组(`replyArr`)存储每条评论里面的回复数，对 回复 进行渲染
     + 获取用户信息，如果是 我 回复的则可以删除
     + 如果获取到的 回复数 等于5，则继续获取这条评论的回复
     + 如果这条评论的回复已经获取完了，则清空`replyArr`，获取下一条评论的回复，如果没有下一条评论(这里通过判断获取第n条评论的n是否等于评论的length)，则执行完毕

5. 个人主页

   + 我的文章(`paintPage`)
     + 判断文章数，如果没有则显示 “这里什么都没有” 的提示框
     + 如果文章数>=1，则渲染文章标题并添加点赞删除等功能
     + 监听`mouseenter`和`mouseleave`事件，鼠标移上时显示更多按钮，点击更多按钮显示删除按钮
     + 点击标题获取文章内容并进入文章详情
   + 我点赞的文章
     + 获取我点赞的文章，如果没有显示 提示框
     + 如果有的话就直接渲染出文章的作者，标题
     + 其他功能和主页差不多
   + 我关注的人
     + 获取我关注的用户，如果没有显示提示框
     + 这里如果直接从用`axios`遍历用户信息(异步)的话会出现乱序的情况，所以这里通过 同步 进行处理，将所有关注的用户信息存储到一个数组中再进行渲染
     + 点击用户的昵称会进入其个人主页
     + 给关注按钮添加关注/取消关注功能
   + 关注我的人
     + 同上
     + 获取我关注的人，和关注我的人对比，如果我关注了关注我的人，则关注按钮显示已关注
   + `axios`返回数据使用for循环渲染时有时候会产生乱序的问题
     + 这个是因为同时对一个接口发送请求而请求时间不同导致的
     + 解决方法，把`axios`的返回数据先存储到一个数组中再进行操作
     + 缺点：同步变异步导致请求时间变长。

6. 别人的个人主页

   因为用的是同一个页面，所以我是将点击功能都封装起来，当进入我的主页和进入别人的主页用的功能不一样，而`onclick`事件是会覆盖的，要利用它的事件覆盖来进行处理

   + 查看这个用户的信息，如果这个人正好就是自己的话就跳转到个人主页，如果不是就跳转到别人的主页。

7. 点赞和点踩

   遍历整个文章列表的数组，先进行点赞，如果点赞失败就取消点赞。文章详情中一个点赞按钮的就获取`isThumbUp`的值来改变点赞按钮的样式。点踩按钮也同理。

8. `emoji`表情

   + 引入`emoji`的`png`图片
   + 将所有`emoji`图片及其名称放到一个数组中
   + 设置正则表达式的规则，查找`[]`或者`/`含的内容
   + 遍历评论或回复有无匹配到正则表达式的规则，如果符合，将对应的文字内容转为表情图片。

补充：

+ 页面跳转使用了一个`pageBlockOrNot`函数，隐藏所有页面，跳转的页面传参

+ 在个人主页那里，没有功能的目录点击后都会显示 “这里什么都没有” 的提示框

+ 接口：通过正则表达式把style样式去掉

  

## 3. 出现的问题

+ 用户写的文章和用户点赞的文章(接口没有返回`isThumbUp`，没有做处理，点赞按钮初始不会亮)
+ 点赞后点踩会自动取消点赞，点踩后也会自动取消点踩（这个问题是最后一天才发现的），还有一些小瑕疵，没时间继续写文档了orz
  + 解决方法：在点赞或点踩的时候获取文章详情，通过对`isDislike`和`isThumbUp`的判断来使用接口和改变结果。
  + 评论的点赞和点踩功能合并在一个函数中了，在里面声明点赞数，通过点赞和点踩的结果来改变点赞数
+ 头像有时会裂开

